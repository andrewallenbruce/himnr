---
title: "Fee Calculation"
author: "Andrew Allen Bruce"
---

```{r setup}
#| message: false
#| warning: false
#| echo: false
#| cache: false

source("setup-doc.R")
```


# Payment Formulas

|          |                                                   |
|----------|---------------------------------------------------|
| $RVU_w$  | *Work* Relative Value Unit                        |
| $GPCI_w$ | *Work* Geographic Practice Cost Index             |
| $RVU_p$  | *Practice Expense* Relative Value Unit            |
| $GPCI_p$ | *Practice Expense* Geographic Practice Cost Index |
| $RVU_m$  | *Malpractice* Relative Value Unit                 |
| $GPCI_m$ | *Malpractice* Geographic Practice Cost Index      |
| $CF$     | Conversion Factor                                 |

<br>

The formulas for the 2024 {{< acr MPFS >}} payment amounts are as follows:

::: panel-tabset
## Participating

$$ x = [(RVU_w \times GPCI_w) + (RVU_p \times GPCI_p) + (RVU_m \times GPCI_m)] \times CF $$

## Non-Participating

$$ y = 0.95x $$

## Limiting Charge

$$ z = 0.95(1.15x) $$
:::

As there is a corresponding GPCI value for each of the three components of an RVU, the formula is essentially the [dot product](https://www.toppr.com/guides/maths-formulas/dot-product-formula/) of the RVU and GPCI vectors, multiplied by the conversion factor:

$$ a \cdot b = a_1b_1 + a_2b_2 + a_3b_3$$

$$
  f(y;a,b) = \begin{cases}
    \frac{1}{b-a} & \text{if } a \leq y \leq b, \\
    0 & \text{otherwise}.
  \end{cases}
$$

```{r}
wrvu  = 6.26   # Work RVU
wgpci = 1      # Work GPCI

pgpci = 0.883  # Practice GPCI
prvu  = 4.36   # Practice RVU

mrvu  = 0.99   # Malpractice RVU
mgpci = 1.125  # Malpractice GPCI

cf    = 32.744 # Conversion Factor
```

```{r}
((wrvu * wgpci) + (prvu * pgpci) + (mrvu * mgpci)) * cf
```

```{r}
# using base r's matrix multiplication infix operator
c(wrvu, prvu, mrvu) %*% c(wgpci, pgpci, mgpci) * cf
```

```{r}
#| message: false
#| warning: false

library(pracma)
dot(c(wrvu, prvu, mrvu), c(wgpci, pgpci, mgpci)) * cf
```

```{r}
calculate_amounts(
  wrvu  = 6.26,
  nprvu = 7.92,
  fprvu = 4.36,
  mrvu  = 0.99,
  cf    = 32.744,
  wgpci = 1,
  pgpci = 0.883,
  mgpci = 1.125
)
```

<br>